var Hero_Speed=11,Hero=function(t){function i(){i.super(this),this.onInit()}Laya.class(i,"Hero",t),_proto=i.prototype;return _proto.anim=null,_proto.effectAnim=null,_proto.targetPos=null,_proto.targetVector=null,_proto.targetPos2=null,_proto.targetVector2=null,_proto.targetTower=null,_proto.isMoveFinsih1=!1,_proto.isMoveFinsih2=!1,_proto.HeroRadios=50,_proto.attackValue=200,_proto.attackRadios=150,_proto.isAttack=!1,_proto.attackMonsterList=null,_proto.isResetMove=!1,_proto.heroSpeed=11,_proto.onInit=function(){if(this.width=110,this.height=110,this.pivotX=55,this.pivotY=55,ShowRang){var t=new Laya.Sprite;t.graphics.drawCircle(0,0,this.attackRadios,"#84ff00","#84ff00",1),t.x=this.pivotX,t.y=this.pivotY,this.addChild(t)}if(this.anim=new Laya.Animation,this.anim.play(0,!0,"hero_attack"),this.anim.pivotX=179,this.anim.pivotY=147,this.anim.pos(this.pivotX,this.pivotY),this.addChild(this.anim),ShowRang){var i=new Laya.Sprite;i.graphics.drawCircle(0,0,this.HeroRadios,"#ff0000","#ff0000",1),i.x=this.pivotX,i.y=this.pivotY,this.addChild(i)}_proto.attackMonsterList=[],MessageController.getInstance().AddNotification("Tower_Dead",this,this._towerDeadEvent)},_proto.onDestroy=function(){},_proto.stopAnim=function(){this.anim.play(0,!0,"hero_attack"),this.anim.stop()},_proto.playAnim=function(){this.anim.destroy(),this.anim=new Laya.Animation,this.anim.interval=40,this.anim.play(0,!0,"hero_attack"),this.anim.pivotX=179,this.anim.pivotY=147,this.anim.pos(this.pivotX,this.pivotY),this.addChild(this.anim)},_proto.setTargetPos=function(t){if(null==this.targetTower&&(this.targetTower=SceneManager.getInstance().currentScene.curTower),!this.pointIsInCircle(t)){this.reserTarget();this.lineIsCollisionTower(t)}},_proto.reserTarget=function(){this.isMoveFinsih1=!1,this.isMoveFinsih2=!1,this.targetPos=null,this.targetVector=null,this.targetPos2=null,this.targetVector2=null},_proto.onUpdate=function(){this.heroMove(),this.attackMonster()},_proto.heroMove=function(){if(!(this.isMoveFinsih1&&this.isMoveFinsih2||null==this.targetPos))if(this.isMoveFinsih1)if(null==this.targetPos2)this.isMoveFinsih2=!0;else{isCollisionWithTwoCricle(new Point(this.x,this.y),this.heroSpeed,this.targetPos2,this.heroSpeed)?(this.isMoveFinsih2=!0,this.x=this.targetPos2.x,this.y=this.targetPos2.y):this.pos(this.x+this.targetVector2.x*this.heroSpeed,this.y+this.targetVector2.y*this.heroSpeed)}else{isCollisionWithTwoCricle(new Point(this.x,this.y),this.heroSpeed,this.targetPos,this.heroSpeed)?(this.isMoveFinsih1=!0,this.x=this.targetPos.x,this.y=this.targetPos.y):this.pos(this.x+this.targetVector.x*this.heroSpeed,this.y+this.targetVector.y*this.heroSpeed)}},_proto.lineIsCollisionTower=function(t){var i=new Point(this.x,this.y);this.targetPos=t,this.targetVector=PointSub(t,i);var e=Math.pow(this.targetVector.x,2)+Math.pow(this.targetVector.y,2);this.targetVector.normalize();var o=this.parent.localToGlobal(new Point(this.x,this.y),!0);SceneManager.getInstance().currentScene.createPointLine(o,t);var s=this.targetTower.parent.localToGlobal(new Point(this.targetTower.x,this.targetTower.y),!0);s=this.parent.globalToLocal(s);var r=PointSub(s,i),a=Math.pow(r.x,2)+Math.pow(r.y,2),n=PointSub(s,i);n.normalize();var h=r.x*this.targetVector.x+r.y*this.targetVector.y,c=Math.pow(h,2),p=n.x*this.targetVector.x+n.y*this.targetVector.y;if(Math.pow(this.targetTower.TowerRadios-0,2)>a-c&&p>0&&e>a){var l=new Point(h*this.targetVector.x+this.x,h*this.targetVector.y+this.y),g=PointSub(l,s);g.normalize();var f=new Point((this.targetTower.TowerRadios+20)*g.x+s.x,(this.targetTower.TowerRadios+20)*g.y+s.y);this.targetPos=f,this.targetVector=PointSub(f,i),this.targetVector.normalize(),this.targetPos2=t,this.targetVector2=PointSub(t,f),this.targetVector2.normalize();var d=this.parent.localToGlobal(new Point(this.targetPos.x,this.targetPos.y),!0);return SceneManager.getInstance().currentScene.createPointLine(o,d,d,t),!0}return!1},_proto.pointIsInCircle=function(t){var i=this.targetTower.parent.globalToLocal(new Point(t.x,t.y),!0);return Number(Math.pow(i.x-this.targetTower.x,2)+Math.pow(i.y-this.targetTower.y,2))<Math.pow(this.targetTower.TowerRadios,2)},_proto.getPointDistance=function(t,i){var e=Number(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2));return Number(Math.sqrt(e))},_proto.getAttackMonsterList=function(){this.attackMonsterList=[];for(var t=SceneManager.getInstance().currentScene.monsterList,i=0;i<t.length;i++){var e=t[i];isCollisionWithTwoCricle(new Point(this.x,this.y),this.attackRadios,e,e.MonsterRadios)&&this.attackMonsterList.push(e)}},_proto.attackMonster=function(){if(!this.isAttack){this.getAttackMonsterList();var t=this.attackMonsterList.length;if(0!=t){this.isAttack=!0;for(var i=0;i<t;i++){var e=this.attackMonsterList[i];e.hp>0&&e.hurtMonster(this.attackValue)}Laya.timer.once(200,this,function(){this.isAttack=!1})}}},_proto._towerDeadEvent=function(t){this.anim.interval=300,this.anim.play(0,!1,"hero_dead"),this.anim.on(Laya.Event.COMPLETE,this,function(){Laya.timer.clear(this,this.resetSpeed),this.resetSpeed(),SceneManager.getInstance().currentScene.gameover()}),MusicManager.getInstance().playSound("res/music/hero_dead.wav")},_proto.addSpeed=function(t,i){Laya.timer.clear(this,this.resetSpeed),null!=this.effectAnim&&this.effectAnim.destroy(),this.effectAnim=new Laya.Animation,this.effectAnim.interval=100,this.effectAnim.play(0,!0,"hero_speed"),this.effectAnim.pivotX=40,this.effectAnim.pivotY=43,this.effectAnim.scaleX=2,this.effectAnim.scaleY=2,this.effectAnim.pos(this.pivotX,this.pivotY-40),this.addChild(this.effectAnim),this.heroSpeed=Hero_Speed+t,Laya.timer.once(i,this,this.resetSpeed)},_proto.resetSpeed=function(){this.heroSpeed=Hero_Speed,null!=this.effectAnim&&this.effectAnim.destroy()},i}(Laya.Sprite);