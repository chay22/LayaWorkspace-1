var Monster=function(t){function e(){e.super(this),this.onInit()}Laya.class(e,"Monster",t),_proto=e.prototype;return _proto.anim=null,_proto.targetPos=null,_proto.targetVector=null,_proto.targetAngle=0,_proto.MonsterRadios=30,_proto.targetTower=null,_proto.targetHero=null,_proto.hp=100,_proto.maxHp=100,_proto.hpProgress=null,_proto.attackValue=50,_proto.isAttack=!1,_proto.isHurt=!1,_proto.hurtSprite=null,_proto.monsterSpeed=1,_proto.monsterScore=0,_proto.monsterData=null,_proto.onInit=function(){this.width=110,this.height=110,this.pivotX=55,this.pivotY=55,this.anim=new Laya.Animation,this.anim.play(0,!0,"monster01_up"),this.anim.pivotX=52,this.anim.pivotY=56,this.anim.interval=200,this.anim.pos(this.pivotX,this.pivotY),this.addChild(this.anim),this.hpProgress=new Laya.ProgressBar("game/progress.png"),this.hpProgress.anchorX=.5,this.hpProgress.anchorY=.5,this.hpProgress.value=1,this.hpProgress.pos(55,0)},_proto.onDestroy=function(){_proto.targetTower=null,_proto.targetHero=null,_proto.isAttack=!1,_proto.isHurt=!1},_proto.initMonster=function(t,e){this.hurtSprite=new Laya.Image("game/penjian-texiao.png"),SceneManager.getInstance().currentScene.floorBoard.addChild(this.hurtSprite),this.anim.scaleX=1;var r=1;2!=t&&3!=t||(this.anim.scaleX=-1),3!=t&&4!=t||(r=2);for(var i=[],s=0;s<MonsterData.length;s++){var o=MonsterData[s];o.type==r&&i.push(o)}var a=i[e];if(this.monsterData=a,this.anim.clear(),this.anim.play(0,!0,a.anim),this.anim.visible=!0,this.hp=a.hp,this.maxHp=a.hp,this.attackValue=a.attack,this.monsterSpeed=a.speed,this.monsterScore=a.score,this.MonsterRadios=a.radius,ShowRang){var n=new Laya.Sprite;n.graphics.drawCircle(0,0,this.MonsterRadios,"#ff0000","#ff0000",1),n.x=this.pivotX,n.y=this.pivotY,this.addChild(n)}},_proto.setTargetPos=function(t,e){this.targetPos=t;var r=new Point(this.x,this.y),i=PointSub(t,r);i.normalize(),this.targetVector=i,this.setHurtRotation(e)},_proto.setHurtRotation=function(t){this.targetAngle=t;var e=Math.abs(this.targetPos.x-this.x),r=Math.abs(this.targetPos.y-this.y),i=360*Math.atan(r/e)/(2*Math.PI);this.hurtSprite.visible=!1,this.hurtSprite.anchorY=1,this.targetAngle>=180&&this.targetAngle<270?(this.hurtSprite.pos(0,0),this.hurtSprite.rotation=225+i):this.targetAngle>=270&&this.targetAngle<360?(this.hurtSprite.pos(110,0),this.hurtSprite.rotation=90-i-45):this.targetAngle>0&&this.targetAngle<90?(this.hurtSprite.pos(110,110),this.hurtSprite.rotation=90+i-45):this.targetAngle>=90&&this.targetAngle<180&&(this.hurtSprite.pos(0,110),this.hurtSprite.rotation=90-i+180-45)},_proto.onUpdate=function(){if(null==this.targetTower&&(this.targetTower=SceneManager.getInstance().currentScene.curTower),null==this.targetHero&&(this.targetHero=SceneManager.getInstance().currentScene.curHero),null!=this.targetPos)if(this.hp>0){isCollisionWithTwoCricle(new Point(this.x,this.y),this.MonsterRadios,this.targetTower,this.targetTower.TowerRadios)?this.attackTower():this.pos(this.x+this.targetVector.x*this.monsterSpeed,this.y+this.targetVector.y*this.monsterSpeed)}else this.monsterDead()},_proto.attackTower=function(){this.isAttack||(this.isAttack=!0,MusicManager.getInstance().playSound("res/music/enemy_hit.wav"),this.targetTower.hp>0&&(this.targetTower.hurtMonster(this.attackValue),Laya.timer.once(500,this,function(){this.isAttack=!1})))},_proto.hurtMonster=function(t){this.isHurt=!0,this.hp-=t,this.hp>0?this.hpProgress.value=this.hp/this.maxHp:this.monsterDead()},_proto.monsterDead=function(){this.hpProgress.value=0;var t=new Notification("Monster_Dead",this,this);MessageController.getInstance().SendNotification(t),MusicManager.getInstance().playSound("res/music/tower_hit.wav"),this.anim.visible=!1,this.hpProgress.visible=!1,this.hurtSprite.visible=!0,this.hurtSprite.alpha=1;var e=this.localToGlobal(new Point(this.hurtSprite.x,this.hurtSprite.y),!0);this.hurtSprite.pos(e.x,e.y),this.createProp(),Laya.Tween.to(this.hurtSprite,{alpha:0},1e3,null,new Laya.Handler(this,function(){MonsterFactory.getInstance().recoveryMonsterToPool(this)}))},_proto.createProp=function(){var t=parseInt(1e4*Math.random(),10),e=this.monsterData.props.length;if(0!=e){for(var r=0,i=-1,s=this.getDiff(),o=0;o<e;o++){var a=this.monsterData.props[o],n=a.weight-s;if(n<0&&(n=0),r+=n,t<=r){i=a.propId;break}}-1!=i&&(Gamelog("-------createProp monsterRanomNum="+t+",t_weight="+r+",t_type="+i),SceneManager.getInstance().currentScene.createProp(this.x,this.y,i))}},_proto.getDiff=function(){for(var t=0,e=SceneManager.getInstance().currentScene,r=MonsterRefreshData.length-1;r>=0;r--){var i=MonsterRefreshData[r];if(e.gameScore>i.score){t=i.diff;break}}return t},e}(Laya.Sprite);